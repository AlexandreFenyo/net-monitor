<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>

<script src="display/node_modules/webstomp-client/dist/webstomp.min.js"></script>
<script src="display/node_modules/jquery/dist/jquery.min.js"></script>

<script type="text/javascript">

var canStartCpt = 0;
function canStart() {
	canStartCpt++;
	if (canStartCpt == 2) {
		sendMessage("canstart");
	}	
};

$(window).bind("load", function() {
	canStart();
});

var connection = new WebSocket("ws://localhost:8080/net-monitor/dispatch/socket", "json");
var stompClient = webstomp.over(connection);
stompClient.connect({}, function(frame) {
	console.log("XXX");
});

connection.onopen = function() {
	console.log("websocket connected");
	canStart();
};

connection.onerror = function(error) {
	console.log("websocket error " + error);
};

connection.onmessage = function(e) {
	console.log("websocket message");
	if(e.data.indexOf("subProtocol") == -1)
	document.getElementById("response").innerHTML = e.data + "<br/>";
};

function sendMessage(msg) {
	stompClient.send("/app/canStart", {priority: 9}, "Hello, STOMP");
}

</script>

</head>


<body>Page HTML<br/>
servlet controller : <a href="dispatch/request">dispatch/request</a>

</body>
</html>
